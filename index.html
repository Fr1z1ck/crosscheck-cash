<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Система сравнения заказов и КАССЫ для быстрого выявления расхождений">
    <title>Система сравнения заказов</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Проверяем, запущено ли приложение в Electron -->
    <script>
        // Определяем, работаем ли мы в Electron
        window.isElectron = typeof window !== 'undefined' && window.process && window.process.type === 'renderer';
        
        // Если работаем в Electron, используем другой подход к загрузке библиотек
        if (!window.isElectron) {
            // Локальная версия для браузера
            document.write('<script src="libs/xlsx.full.min.js"><\/script>');
            // Резервная CDN версия
            document.write('<script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"><\/script>');
        }
    </script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Проверка и резервная загрузка библиотеки XLSX -->
    <script>
        // Функция для проверки, загружена ли библиотека XLSX
        function checkXLSXLoaded() {
            if (typeof XLSX === 'undefined' && !window.isElectron) {
                console.log('XLSX не загружен, пробуем альтернативный CDN...');
                // Создаем новый элемент script
                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js';
                script.async = true;
                script.onload = function() {
                    console.log('XLSX успешно загружен с альтернативного CDN');
                };
                script.onerror = function() {
                    console.error('Не удалось загрузить XLSX с альтернативного CDN');
                    alert('Ошибка загрузки библиотеки XLSX. Приложение может работать некорректно. Попробуйте обновить страницу или проверьте подключение к интернету.');
                };
                document.head.appendChild(script);
            } else {
                console.log('XLSX успешно загружен или работаем в Electron');
            }
        }
        
        // Выполняем проверку после загрузки страницы
        window.addEventListener('load', checkXLSXLoaded);
    </script>
</head>
<body class="classic-theme">
    <div class="container">
        <header>
            <h1><i class="fas fa-box-check"></i> Система сравнения заказов и КАССЫ</h1>
            <div class="header-controls">
                <button id="guideBtn" class="btn icon-btn" title="Руководство пользователя">
                    <i class="fas fa-question-circle"></i>
                </button>
                <button id="settingsBtn" class="btn icon-btn" title="Настройки внешнего вида">
                    <i class="fas fa-gear"></i>
                </button>
            </div>
        </header>

        <!-- Зона загрузки файлов -->
        <div class="file-upload-section">
            <h2 class="section-title">
                <i class="fas fa-file-upload"></i>
                Загрузка данных
            </h2>
            
            <div class="upload-container">
                <!-- Блок для загрузки Excel файла МС -->
                <div id="fileDropZone" class="file-drop-zone">
                    <div class="upload-decoration">
                        <div class="decoration-circle circle1"></div>
                        <div class="decoration-circle circle2"></div>
                        <div class="decoration-circle circle3"></div>
                    </div>
                    
                    <div class="upload-icon">
                        <i class="fas fa-file-excel"></i>
                    </div>
                    
                    <label for="fileInput" class="file-label">
                        Выберите файл заказа МС
                    </label>
                    
                    <p class="file-hint">
                        Перетащите файл Excel в эту область или нажмите кнопку ниже
                        <br><small class="file-format-hint">Поддерживаемые форматы: Excel (.xls, .xlsx)</small>
                    </p>
                    
                    <input type="file" id="fileInput" class="file-input" accept=".xlsx,.xls" style="display: none;">
                    
                    <button class="select-files-btn">
                        <i class="fas fa-folder-open"></i>
                        <span>Выбрать файл МС</span>
                    </button>
                </div>
                
                <!-- Блок для вставки данных КАССЫ -->
                <div id="textInputZone" class="text-input-zone">
                    <div class="upload-decoration">
                        <div class="decoration-circle circle1"></div>
                        <div class="decoration-circle circle2"></div>
                        <div class="decoration-circle circle3"></div>
                    </div>
                    
                    <div class="upload-icon">
                        <i class="fas fa-paste"></i>
                    </div>
                    
                    <label for="kassaTextarea" class="file-label">
                        Вставьте данные из КАССЫ
                    </label>
                    
                    <p class="file-hint">
                        Скопируйте данные из КАССЫ (Ctrl+C) и вставьте в поле ниже (Ctrl+V)
                    </p>
                    
                    <textarea id="kassaTextarea" class="kassa-textarea" placeholder="Вставьте сюда данные из КАССЫ..."></textarea>
                    
                    <button id="clearTextBtn" class="clear-text-btn">
                        <i class="fas fa-times"></i>
                        <span>Очистить</span>
                    </button>
                </div>
            </div>
            
            <!-- Контейнер для отображения выбранных файлов -->
            <div id="selectedFiles"></div>
            
            <div class="button-group">
                <button id="analyzeBtn" class="analyze-btn" disabled>
                    <i class="fas fa-search"></i>
                    <span>Сравнить данные</span>
                </button>
                <button id="resetBtn" class="reset-btn">
                    <i class="fas fa-times"></i>
                    <span>Сбросить</span>
                </button>
            </div>
        </div>

        <main class="results-section" id="results">
            <h2><i class="fas fa-chart-bar"></i> Результаты сравнения</h2>
            
            <div class="stats-container" id="statsContainer" style="display: none;">
                <h3><i class="fas fa-chart-pie"></i> Сводная статистика</h3>
                <div class="stats-grid">
                    <div class="stat-item" title="Общее количество товаров в заказе">
                        <i class="fas fa-boxes fa-lg" style="color: var(--primary-color); margin-bottom: 0.5rem;"></i>
                        <span class="stat-label">Товаров в заказе МС</span>
                        <span class="stat-value" id="orderItems">0</span>
                    </div>
                    <div class="stat-item" title="Общее количество товаров в КАССЕ">
                        <i class="fas fa-barcode fa-lg" style="color: var(--primary-color); margin-bottom: 0.5rem;"></i>
                        <span class="stat-label">Товаров в КАССЕ</span>
                        <span class="stat-value" id="scanItems">0</span>
                    </div>
                    <div class="stat-item missing" title="Товары из заказа, которых нет в КАССЕ">
                        <i class="fas fa-times-circle fa-lg" style="color: var(--missing-text); margin-bottom: 0.5rem;"></i>
                        <span class="stat-label">Отсутствующих товаров</span>
                        <span class="stat-value" id="missingItems">0</span>
                    </div>
                    <div class="stat-item extra" title="Товары в КАССЕ, которых нет в заказе">
                        <i class="fas fa-plus-circle fa-lg" style="color: var(--extra-text); margin-bottom: 0.5rem;"></i>
                        <span class="stat-label">Избыточных товаров</span>
                        <span class="stat-value" id="extraItems">0</span>
                    </div>
                    <div class="stat-item mismatch" title="Количество товаров с несоответствием количества">
                        <i class="fas fa-exchange-alt fa-lg" style="color: var(--mismatch-text); margin-bottom: 0.5rem;"></i>
                        <span class="stat-label">Несоответствие количества</span>
                        <span class="stat-value" id="quantityMismatches">0</span>
                    </div>
                    <div class="stat-item incomplete" title="Количество товаров без штрих-кода или количества">
                        <i class="fas fa-exclamation-circle fa-lg" style="color: #9333ea; margin-bottom: 0.5rem;"></i>
                        <span class="stat-label">Некорректные позиции</span>
                        <span class="stat-value" id="incompleteItems">0</span>
                    </div>
                </div>
            </div>

            <div class="tabs" role="tablist">
                <button class="tab-btn active" data-tab="all" role="tab" aria-selected="true" title="Показать все товары">
                    <i class="fas fa-list"></i> Все товары
                </button>
                <button class="tab-btn" data-tab="scan" role="tab" aria-selected="false" title="Показать товары из КАССЫ">
                    <i class="fas fa-barcode"></i> Товары в КАССЕ
                </button>
                <button class="tab-btn" data-tab="errors" role="tab" aria-selected="false" title="Показать товары с ошибками">
                    <i class="fas fa-exclamation-triangle"></i> Ошибки
                </button>
                <button class="tab-btn" data-tab="missing" role="tab" aria-selected="false" title="Показать отсутствующие товары">
                    <i class="fas fa-times-circle"></i> Отсутствующие
                </button>
                <button class="tab-btn" data-tab="extra" role="tab" aria-selected="false" title="Показать избыточные товары">
                    <i class="fas fa-plus-circle"></i> Избыточные
                </button>
                <button class="tab-btn" data-tab="mismatch" role="tab" aria-selected="false" title="Показать товары с несоответствием количества">
                    <i class="fas fa-exchange-alt"></i> Несоответствия
                </button>
                <button class="tab-btn" data-tab="incomplete" role="tab" aria-selected="false" title="Показать товары без штрих-кода или количества">
                    <i class="fas fa-exclamation-circle"></i> Некорректные
                </button>
            </div>

            <!-- Фильтр и сортировка для результатов -->
            <div class="filter-sort">
                <div class="search-icon">
                    <i class="fas fa-search"></i>
                    <input type="text" id="filterInput" placeholder="Поиск по артикулу или наименованию..." aria-label="Фильтр товаров" title="Введите текст для поиска товаров по коду или наименованию">
                </div>
                <button id="resetCheckedBtn" class="control-btn reset-checked-btn" title="Сбросить все отмеченные позиции">
                    <i class="fas fa-times-circle"></i> Сбросить
                </button>
                <!-- Кнопка скрытия товаров без маркировки -->
                <button id="toggleUnmarkedBtn" class="control-btn toggle-unmarked-btn">
                    <i class="fas fa-tag"></i>
                    <span>Без марки</span>
                </button>
                <!-- Переключатель режима подсчёта количества -->
                <button id="toggleCountModeBtn" class="control-btn count-mode-btn" title="Переключить режим подсчёта количества товаров">
                    <i class="fas fa-calculator"></i>
                    <span>Подсчёт по значению</span>
                </button>
            </div>

            <div class="tab-content active" id="allTab" role="tabpanel" aria-labelledby="all-tab">
                <table class="results-table">
                    <thead>
                        <tr>
                            <th style="width: 40px;" title="Отметка о проверке">☑</th>
                            <th title="Нажмите для сортировки по коду товара">Код</th>
                            <th title="Нажмите для сортировки по наименованию">Наименование</th>
                            <th title="Нажмите для сортировки по количеству в заказе">Кол-во в заказе</th>
                            <th title="Нажмите для сортировки по количеству в КАССЕ">Кол-во в КАССЕ</th>
                            <th title="Нажмите для сортировки по статусу">Статус</th>
                        </tr>
                    </thead>
                    <tbody id="allTable"></tbody>
                </table>
            </div>

            <div class="tab-content" id="scanTab" role="tabpanel" aria-labelledby="scan-tab">
                <table class="results-table">
                    <thead>
                        <tr>
                            <th style="width: 40px;" title="Отметка о проверке">☑</th>
                            <th title="Нажмите для сортировки по коду товара">Код</th>
                            <th title="Нажмите для сортировки по наименованию">Наименование</th>
                            <th title="Нажмите для сортировки по количеству в КАССЕ">Кол-во в КАССЕ</th>
                            <th title="Нажмите для сортировки по статусу">Статус</th>
                        </tr>
                    </thead>
                    <tbody id="scanTable"></tbody>
                </table>
            </div>

            <div class="tab-content" id="errorsTab" role="tabpanel" aria-labelledby="errors-tab">
                <table class="results-table">
                    <thead>
                        <tr>
                            <th style="width: 40px;" title="Отметка о проверке">☑</th>
                            <th title="Нажмите для сортировки по коду товара">Код</th>
                            <th title="Нажмите для сортировки по наименованию">Наименование</th>
                            <th title="Нажмите для сортировки по количеству в заказе">Кол-во в заказе</th>
                            <th title="Нажмите для сортировки по количеству в КАССЕ">Кол-во в КАССЕ</th>
                            <th title="Нажмите для сортировки по проблеме">Проблема</th>
                        </tr>
                    </thead>
                    <tbody id="errorsTable"></tbody>
                </table>
            </div>

            <div class="tab-content" id="missingTab" role="tabpanel" aria-labelledby="missing-tab">
                <table class="results-table">
                    <thead>
                        <tr>
                            <th style="width: 40px;" title="Отметка о проверке">☑</th>
                            <th title="Нажмите для сортировки по коду товара">Код</th>
                            <th title="Нажмите для сортировки по наименованию">Наименование</th>
                            <th title="Нажмите для сортировки по количеству в заказе">Кол-во в заказе</th>
                        </tr>
                    </thead>
                    <tbody id="missingTable"></tbody>
                </table>
            </div>

            <div class="tab-content" id="extraTab" role="tabpanel" aria-labelledby="extra-tab">
                <table class="results-table">
                    <thead>
                        <tr>
                            <th style="width: 40px;" title="Отметка о проверке">☑</th>
                            <th title="Нажмите для сортировки по коду товара">Код</th>
                            <th title="Нажмите для сортировки по наименованию">Наименование</th>
                            <th title="Нажмите для сортировки по количеству в КАССЕ">Кол-во в КАССЕ</th>
                        </tr>
                    </thead>
                    <tbody id="extraTable"></tbody>
                </table>
            </div>

            <div class="tab-content" id="mismatchTab" role="tabpanel" aria-labelledby="mismatch-tab">
                <table class="results-table">
                    <thead>
                        <tr>
                            <th style="width: 40px;" title="Отметка о проверке">☑</th>
                            <th title="Нажмите для сортировки по коду товара">Код</th>
                            <th title="Нажмите для сортировки по наименованию">Наименование</th>
                            <th title="Нажмите для сортировки по количеству в заказе">Кол-во в заказе</th>
                            <th title="Нажмите для сортировки по количеству в КАССЕ">Кол-во в КАССЕ</th>
                            <th title="Нажмите для сортировки по разнице в количестве">Разница</th>
                        </tr>
                    </thead>
                    <tbody id="mismatchTable"></tbody>
                </table>
            </div>

            <div class="tab-content" id="incompleteTab" role="tabpanel" aria-labelledby="incomplete-tab">
                <table class="results-table">
                    <thead>
                        <tr>
                            <th style="width: 40px;" title="Отметка о проверке">☑</th>
                            <th title="Нажмите для сортировки по коду товара">Код</th>
                            <th title="Нажмите для сортировки по наименованию">Наименование</th>
                            <th title="Нажмите для сортировки по проблеме">Проблема</th>
                        </tr>
                    </thead>
                    <tbody id="incompleteTable"></tbody>
                </table>
            </div>
        </main>
    </div>

    <!-- Модальное окно настроек -->
    <div id="settingsModal" class="modal" role="dialog" aria-labelledby="settingsModalTitle" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="settingsModalTitle"><i class="fas fa-gear"></i> Настройки</h3>
                <span class="close-modal" aria-label="Закрыть" title="Закрыть настройки"><i class="fas fa-times"></i></span>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h4><i class="fas fa-palette"></i> Внешний вид</h4>
                    <h5>Выберите тему оформления:</h5>
                    <div class="theme-options">
                        <div class="theme-option" data-theme="classic">
                            <div class="theme-preview classic-preview">
                                <div class="theme-preview-header">Светлая тема</div>
                                <div class="theme-preview-body">
                                    <div class="theme-preview-content">
                                        <div class="theme-preview-row"></div>
                                        <div class="theme-preview-row"></div>
                                        <div class="theme-preview-row"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="theme-option" data-theme="dark">
                            <div class="theme-preview dark-preview">
                                <div class="theme-preview-header">Тёмная тема</div>
                                <div class="theme-preview-body">
                                    <div class="theme-preview-content">
                                        <div class="theme-preview-row"></div>
                                        <div class="theme-preview-row"></div>
                                        <div class="theme-preview-row"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <h5><i class="fas fa-text-height"></i> Размер шрифта:</h5>
                    <div class="font-size-control">
                        <span class="font-size-label">A<sub>-</sub></span>
                        <input type="range" id="fontSizeSlider" min="80" max="120" step="5" value="100" aria-label="Размер шрифта" title="Перетащите для изменения размера шрифта">
                        <span class="font-size-label">A<sup>+</sup></span>
                        <span class="font-size-value" id="fontSizeValue">100%</span>
                    </div>
                    
                    <h5><i class="fas fa-search"></i> Масштаб интерфейса:</h5>
                    <div class="ui-scale-control">
                        <span class="scale-label"><i class="fas fa-search-minus"></i></span>
                        <input type="range" id="uiScaleSlider" min="70" max="130" step="5" value="100" aria-label="Масштаб интерфейса" title="Перетащите для изменения масштаба интерфейса">
                        <span class="scale-label"><i class="fas fa-search-plus"></i></span>
                        <span class="scale-value" id="uiScaleValue">100%</span>
                    </div>
                </div>

                <div class="settings-section about-section">
                    <h4><i class="fas fa-info-circle"></i> О программе</h4>
                    <p class="about-text">Система контроля товаров разработана для быстрого сравнения заказов и фактического наличия товаров.</p>
                    
                    <div class="about-version">
                        <span id="versionNumber">Версия: 1.0.2</span>
                    </div>
                    
                    <div class="about-developer">
                        <span>Разработчик: <a href="https://t.me/Fr1z1ck" target="_blank" title="Открыть Telegram"><i class="fab fa-telegram"></i> @Fr1z1ck</a></span>
                    </div>
                </div>
            </div>
            
            <!-- Пасхалка с цветочками -->
            <div id="easterEgg" class="easter-egg">
                <div class="easter-egg-content">
                    <div class="flowers-container">
                        <div class="flower flower1"><i class="fas fa-heart"></i></div>
                        <div class="flower flower2"><i class="fas fa-heart"></i></div>
                        <div class="flower flower3"><i class="far fa-heart"></i></div>
                        <div class="flower flower4"><i class="fas fa-heart"></i></div>
                        <div class="flower flower5"><i class="fas fa-heart"></i></div>
                        <div class="flower flower6"><i class="far fa-sun"></i></div>
                        <div class="flower flower7"><i class="fas fa-heart"></i></div>
                        <div class="flower flower8"><i class="far fa-heart"></i></div>
                        <div class="flower flower9"><i class="fas fa-star"></i></div>
                        <div class="flower flower10"><i class="fas fa-heart"></i></div>
                        <div class="flower flower11"><i class="fas fa-asterisk"></i></div>
                        <div class="flower flower12"><i class="fas fa-heart"></i></div>
                        <div class="flower flower13"><i class="fas fa-star"></i></div>
                        <div class="flower flower14"><i class="fas fa-heart"></i></div>
                        <div class="flower flower15"><i class="far fa-heart"></i></div>
                    </div>
                    <h2 class="easter-egg-text" id="easterEggMessage">У меня жена самая лучшая</h2>
                    <div class="easter-egg-buttons">
                        <button id="generateMessageBtn" class="btn secondary-btn"><i class="fas fa-magic"></i> Новое послание</button>
                        <button id="closeEasterEgg" class="btn primary-btn"><i class="fas fa-times"></i> Закрыть</button>
                    </div>
                </div>
                <audio id="easterEggAudio" src="sound1.mp3" preload="auto"></audio>
            </div>
        </div>
    </div>

    <!-- Модальное окно руководства пользователя -->
    <div id="guideModal" class="modal" role="dialog" aria-labelledby="guideModalTitle" aria-hidden="true">
        <div class="modal-content guide-modal">
            <div class="modal-header">
                <h3 id="guideModalTitle"><i class="fas fa-book"></i> Руководство пользователя</h3>
                <span class="close-modal" aria-label="Закрыть" title="Закрыть руководство"><i class="fas fa-times"></i></span>
            </div>
            <div class="modal-body guide-body">
                <div class="guide-navigation">
                    <ul class="guide-tabs">
                        <li class="guide-tab active" data-guide-section="start">
                            <i class="fas fa-play-circle"></i>
                            <span>Начало работы</span>
                        </li>
                        <li class="guide-tab" data-guide-section="files">
                            <i class="fas fa-file-upload"></i>
                            <span>Работа с данными</span>
                        </li>
                        <li class="guide-tab" data-guide-section="comparison">
                            <i class="fas fa-search"></i>
                            <span>Сравнение</span>
                        </li>
                        <li class="guide-tab" data-guide-section="results">
                            <i class="fas fa-table"></i>
                            <span>Работа с результатами</span>
                        </li>
                        <li class="guide-tab" data-guide-section="tips">
                            <i class="fas fa-lightbulb"></i>
                            <span>Полезные советы</span>
                        </li>
                    </ul>
                </div>
                
                <div class="guide-content">
                    <!-- Раздел: Начало работы -->
                    <div class="guide-section active" id="guide-start">
                        <h4>Добро пожаловать!</h4>
                        <p class="guide-description">
                            Система сравнения заказов предоставляет удобный интерфейс для анализа расхождений между данными МС и КАССЫ. Интуитивно понятная навигация и наглядное представление результатов помогут быстро находить несоответствия.
                        </p>
                        <p>Система сравнения заказов позволяет быстро выявить расхождения между заказом в МС и фактическими данными КАССЫ.</p>
                        
                        <div class="guide-steps">
                            <div class="guide-step">
                                <div class="step-number">1</div>
                                <div class="step-content">
                                    <h5>Загрузите данные</h5>
                                    <p>Загрузите файл Excel с данными МС и вставьте скопированные данные из КАССЫ в текстовое поле.</p>
                                </div>
                            </div>
                            
                            <div class="guide-step">
                                <div class="step-number">2</div>
                                <div class="step-content">
                                    <h5>Запустите сравнение</h5>
                                    <p>Нажмите кнопку "Сравнить данные", чтобы система проанализировала данные и выявила расхождения.</p>
                                </div>
                            </div>
                            
                            <div class="guide-step">
                                <div class="step-number">3</div>
                                <div class="step-content">
                                    <h5>Изучите результаты</h5>
                                    <p>Используйте вкладки для просмотра различных категорий товаров: отсутствующие, избыточные, несоответствия.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="guide-features">
                            <h5>Основные возможности:</h5>
                            <ul class="features-list">
                                <li><i class="fas fa-check-circle"></i> Быстрый анализ расхождений</li>
                                <li><i class="fas fa-check-circle"></i> Фильтрация и сортировка результатов</li>
                                <li><i class="fas fa-check-circle"></i> Удобное представление данных</li>
                                <li><i class="fas fa-check-circle"></i> Настройка внешнего вида интерфейса</li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- Раздел: Работа с данными -->
                    <div class="guide-section" id="guide-files">
                        <h4>Работа с данными</h4>
                        <p class="guide-description">
                            Для корректного сравнения необходимо загрузить файл Excel с заказом МС и вставить текст из КАССЫ. Система адаптируется к различным форматам данных, но для наилучших результатов рекомендуется следовать указанным рекомендациям.
                        </p>
                        
                        <h5>Требования к данным</h5>
                        <p>Для корректной работы системы необходимо:</p>
                        
                        <div class="guide-file-types">
                            <div class="file-type">
                                <i class="fas fa-file-excel"></i>
                                <h6>Заказ МС</h6>
                                <p>Файл Excel (.xlsx или .xls), содержащий информацию о заказанных товарах с артикулами и количеством.</p>
                            </div>
                            
                            <div class="file-type">
                                <i class="fas fa-paste"></i>
                                <h6>Данные КАССЫ</h6>
                                <p>Текст, скопированный из КАССЫ и вставленный в текстовое поле. Содержит информацию о товарах с наименованиями и количеством.</p>
                            </div>
                        </div>
                        
                        <div class="guide-format">
                            <h5>Формат данных КАССЫ</h5>
                            <p>Система распознает следующий формат данных из КАССЫ:</p>
                            <pre class="code-example">
47Musthave - Black Currant (Черная смородина), 25 гр (м)
139.00x1
шт
139.00
139.00x1
шт
139.00
46Musthave - Nord Star (Вишня), 25 гр (м)
139.00x1
шт
139.00
139.00x1
шт
139.00</pre>
                            <p>Где каждый товар начинается с номера, за которым следует название товара, а затем информация о цене и количестве (в формате "139.00x1"). Обратите внимание, что для каждого товара информация о цене и количестве может дублироваться - система учитывает это при анализе.</p>
                        </div>
                        
                        <div class="guide-tips">
                            <h5>Советы по работе с данными:</h5>
                            <ul>
                                <li>Скопируйте весь текст из КАССЫ (Ctrl+C) и вставьте его целиком в текстовое поле (Ctrl+V)</li>
                                <li>Убедитесь, что в файле MS есть колонки с наименованием товара и количеством</li>
                                <li>Для сброса введенных данных используйте кнопку "Сбросить"</li>
                                <li>Вы можете очистить только данные КАССЫ, нажав кнопку "Очистить" под текстовым полем</li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- Раздел: Сравнение -->
                    <div class="guide-section" id="guide-comparison">
                        <h4>Процесс сравнения</h4>
                        <p class="guide-description">
                            Алгоритм сравнения автоматически анализирует структуру загруженных данных, выделяет ключевые данные и сопоставляет их для выявления несоответствий. Процесс оптимизирован для быстрой работы даже с большими объемами данных.
                        </p>
                        
                        <h5>Как работает сравнение</h5>
                        <p>Система автоматически определяет структуру данных и сравнивает товары по их наименованиям, учитывая количество каждого товара.</p>
                        
                        <div class="comparison-info">
                            <div class="comparison-step">
                                <div class="step-icon"><i class="fas fa-file-import"></i></div>
                                <div class="step-info">
                                    <h6>Анализ данных</h6>
                                    <p>Определение структуры данных и извлечение информации о товарах</p>
                                </div>
                            </div>
                            
                            <div class="comparison-step">
                                <div class="step-icon"><i class="fas fa-random"></i></div>
                                <div class="step-info">
                                    <h6>Сопоставление</h6>
                                    <p>Поиск соответствий между товарами из двух источников по наименованию</p>
                                </div>
                            </div>
                            
                            <div class="comparison-step">
                                <div class="step-icon"><i class="fas fa-exclamation-triangle"></i></div>
                                <div class="step-info">
                                    <h6>Выявление расхождений</h6>
                                    <p>Определение отсутствующих, избыточных товаров и несоответствий количества</p>
                                </div>
                            </div>
                            
                            <div class="comparison-step">
                                <div class="step-icon"><i class="fas fa-table"></i></div>
                                <div class="step-info">
                                    <h6>Формирование результатов</h6>
                                    <p>Группировка и отображение данных по категориям</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Раздел: Работа с результатами -->
                    <div class="guide-section" id="guide-results">
                        <h4>Работа с результатами</h4>
                        <p class="guide-description">
                            После сравнения система предоставляет детальный отчет в виде таблиц с возможностью сортировки, фильтрации и поиска. Результаты разделены на категории для удобного анализа найденных расхождений.
                        </p>
                        
                        <h5>Категории результатов</h5>
                        <div class="categories-info">
                            <div class="category-item">
                                <div class="category-icon"><i class="fas fa-list"></i></div>
                                <div class="category-details">
                                    <h6>Все товары</h6>
                                    <p>Полный список всех товаров из обоих источников с их статусом</p>
                                </div>
                            </div>
                            
                            <div class="category-item">
                                <div class="category-icon"><i class="fas fa-barcode"></i></div>
                                <div class="category-details">
                                    <h6>Товары в КАССЕ</h6>
                                    <p>Все товары, найденные в данных КАССЫ</p>
                                </div>
                            </div>
                            
                            <div class="category-item">
                                <div class="category-icon"><i class="fas fa-exclamation-triangle"></i></div>
                                <div class="category-details">
                                    <h6>Ошибки</h6>
                                    <p>Сводка всех проблемных товаров с указанием типа проблемы</p>
                                </div>
                            </div>
                            
                            <div class="category-item">
                                <div class="category-icon missing-icon"><i class="fas fa-times-circle"></i></div>
                                <div class="category-details">
                                    <h6>Отсутствующие</h6>
                                    <p>Товары из заказа, которых нет в данных КАССЫ</p>
                                </div>
                            </div>
                            
                            <div class="category-item">
                                <div class="category-icon extra-icon"><i class="fas fa-plus-circle"></i></div>
                                <div class="category-details">
                                    <h6>Избыточные</h6>
                                    <p>Товары из данных КАССЫ, которых нет в заказе</p>
                                </div>
                            </div>
                            
                            <div class="category-item">
                                <div class="category-icon mismatch-icon"><i class="fas fa-exchange-alt"></i></div>
                                <div class="category-details">
                                    <h6>Несоответствия</h6>
                                    <p>Товары с расхождением в количестве между заказом и данными КАССЫ</p>
                                </div>
                            </div>

                            <div class="category-item">
                                <div class="category-icon" style="background-color: rgba(147, 51, 234, 0.1); color: #9333ea;">
                                    <i class="fas fa-exclamation-circle"></i>
                                </div>
                                <div class="category-details">
                                    <h6>Некорректные</h6>
                                    <p>Товары с отсутствующим или неверным количеством в данных КАССЫ</p>
                                </div>
                            </div>
                        </div>
                        
                        <h5>Функции работы с результатами</h5>
                        <div class="results-functions">
                            <div class="function-item">
                                <i class="fas fa-search"></i>
                                <h6>Поиск</h6>
                                <p>Используйте поле поиска для фильтрации товаров по артикулу или наименованию</p>
                            </div>
                            
                            <div class="function-item">
                                <i class="fas fa-sort"></i>
                                <h6>Сортировка</h6>
                                <p>Сортируйте товары по любому столбцу, нажав на заголовок таблицы</p>
                            </div>
                            
                            <div class="function-item">
                                <i class="fas fa-clipboard-check"></i>
                                <h6>Отметка о проверке</h6>
                                <p>Используйте чекбоксы в первой колонке для отметки проверенных позиций</p>
                            </div>

                            <div class="function-item">
                                <i class="fas fa-times-circle"></i>
                                <h6>Сброс отметок</h6>
                                <p>Нажмите кнопку "Сбросить" для мгновенного сброса всех отметок о проверке</p>
                            </div>
                            
                            <div class="function-item">
                                <i class="fas fa-tag"></i>
                                <h6>Фильтр маркировки</h6>
                                <p>Используйте кнопку "Без марки" для скрытия/отображения товаров без маркировки</p>
                            </div>
                            
                            <div class="function-item">
                                <i class="fas fa-calculator"></i>
                                <h6>Режим подсчёта</h6>
                                <p>Переключайте способ определения количества товаров в данных КАССЫ: по указанному значению или по числу упоминаний</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Раздел: Полезные советы -->
                    <div class="guide-section" id="guide-tips">
                        <h4>Полезные советы</h4>
                        
                        <div class="tips-container">
                            <div class="tip-card">
                                <div class="tip-icon"><i class="fas fa-bolt"></i></div>
                                <h5>Быстрая работа</h5>
                                <p>Используйте перетаскивание файла Excel для более быстрой загрузки</p>
                            </div>
                            
                            <div class="tip-card">
                                <div class="tip-icon"><i class="fas fa-paste"></i></div>
                                <h5>Данные КАССЫ</h5>
                                <p>Копируйте и вставляйте данные КАССЫ точно так, как они отображаются, не редактируя их структуру</p>
                            </div>
                            
                            <div class="tip-card">
                                <div class="tip-icon"><i class="fas fa-calculator"></i></div>
                                <h5>Режимы подсчёта</h5>
                                <p>Используйте разные режимы подсчёта количества товаров в зависимости от формата данных КАССЫ</p>
                            </div>
                            
                            <div class="tip-card">
                                <div class="tip-icon"><i class="fas fa-eye"></i></div>
                                <h5>Маркировка товаров</h5>
                                <p>Товары без маркировки всегда отображаются в конце списка ошибок. Используйте кнопку "Без марки" для их скрытия</p>
                            </div>
                            
                            <div class="tip-card">
                                <div class="tip-icon"><i class="fas fa-moon"></i></div>
                                <h5>Темная тема</h5>
                                <p>Используйте темную тему для комфортной работы в условиях плохого освещения</p>
                            </div>
                            
                            <div class="tip-card">
                                <div class="tip-icon"><i class="fas fa-search-plus"></i></div>
                                <h5>Масштабирование</h5>
                                <p>Настраивайте размер шрифта и масштаб интерфейса под свои предпочтения</p>
                            </div>
                            
                            <div class="tip-card">
                                <div class="tip-icon"><i class="fas fa-clipboard-check"></i></div>
                                <h5>Отметка о проверке</h5>
                                <p>Отмечайте проверенные товары для контроля своей работы, отметки сохраняются между сеансами</p>
                            </div>
                            
                            <div class="tip-card">
                                <div class="tip-icon"><i class="fas fa-times-circle"></i></div>
                                <h5>Быстрый сброс</h5>
                                <p>Быстро сбрасывайте все отметки о проверке одним нажатием кнопки "Сбросить"</p>
                            </div>
                        </div>
                        
                        <div class="faq-section">
                            <h5>Вопросы</h5>
                            
                            <div class="faq-item">
                                <div class="faq-question">
                                    <i class="fas fa-question-circle"></i>
                                    <span>Что делать, если система не определяет структуру файла?</span>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="faq-answer">
                                    <p>Проверьте, что файл содержит необходимые колонки: код/артикул товара, наименование и количество. При необходимости переименуйте заголовки колонок.</p>
                                </div>
                            </div>
                            
                            <div class="faq-item">
                                <div class="faq-question">
                                    <i class="fas fa-question-circle"></i>
                                    <span>Как правильно вставить данные из КАССЫ?</span>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="faq-answer">
                                    <p>Выделите и скопируйте (Ctrl+C) весь текст из КАССЫ, затем вставьте (Ctrl+V) его в текстовое поле. Система автоматически распознает формат и структуру данных, учитывая дублирующиеся строки с информацией о цене и количестве.</p>
                                </div>
                            </div>
                            
                            <div class="faq-item">
                                <div class="faq-question">
                                    <i class="fas fa-question-circle"></i>
                                    <span>Как определить, какие товары без маркировки?</span>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="faq-answer">
                                    <p>Товары без маркировки - это товары, в названии которых нет обозначения "(М)" или окончания "м" или "м.". Они всегда отображаются в конце списка во вкладке "Ошибки".</p>
                                </div>
                            </div>
                            
                            <div class="faq-item">
                                <div class="faq-question">
                                    <i class="fas fa-question-circle"></i>
                                    <span>Как обновить данные после внесения изменений?</span>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="faq-answer">
                                    <p>Нажмите кнопку "Сбросить", загрузите обновленный файл МС и/или вставьте актуальные данные КАССЫ, затем запустите сравнение заново.</p>
                                </div>
                            </div>

                            <div class="faq-item">
                                <div class="faq-question">
                                    <i class="fas fa-question-circle"></i>
                                    <span>Что означает статус "Некорректный"?</span>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="faq-answer">
                                    <p>Статус "Некорректный" присваивается товарам, у которых не указано или неверно указано количество. Такие позиции требуют особого внимания и проверки в системе КАССЫ.</p>
                                </div>
                            </div>

                            <div class="faq-item">
                                <div class="faq-question">
                                    <i class="fas fa-question-circle"></i>
                                    <span>Почему система показывает двойное количество товаров?</span>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="faq-answer">
                                    <p>Иногда в данных КАССЫ информация о цене и количестве товара дублируется. Система учитывает эту особенность и корректно суммирует количество товаров, исключая двойной подсчет. Если вы все же наблюдаете неправильное отображение количества, убедитесь, что данные КАССЫ вставлены полностью и без изменений.</p>
                                </div>
                            </div>

                            <div class="faq-item">
                                <div class="faq-question">
                                    <i class="fas fa-question-circle"></i>
                                    <span>Как отмечать проверенные позиции?</span>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="faq-answer">
                                    <p>Нажмите на чекбокс в первой колонке рядом с товаром, чтобы отметить его как проверенный. Эта отметка сохраняется во всех вкладках и между сеансами. Для сброса всех отметок используйте кнопку "Сбросить проверки".</p>
                                </div>
                            </div>

                            <div class="faq-item">
                                <div class="faq-question">
                                    <i class="fas fa-question-circle"></i>
                                    <span>Что означает кнопка "Режим подсчёта"?</span>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="faq-answer">
                                    <p>Кнопка "Режим подсчёта" позволяет выбирать между двумя способами определения количества товаров в данных КАССЫ:
                                    <br>- <strong>По значению</strong> (по умолчанию): использует количество, указанное в данных КАССЫ (например, "139.00x1" означает 1 штуку)
                                    <br>- <strong>По упоминания</strong>: определяет количество товара по числу его упоминаний в тексте КАССЫ, игнорируя указанное количество
                                    <br>Режим "По упоминания" может быть полезен, если в КАССЕ каждый экземпляр товара указан отдельной строкой.</p>
                                </div>
                            </div>

                            <div class="faq-item">
                                <div class="faq-question">
                                    <i class="fas fa-question-circle"></i>
                                    <span>Какой режим подсчёта выбрать?</span>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="faq-answer">
                                    <p>Выбор режима подсчёта зависит от формата данных КАССЫ:
                                    <br>- Используйте режим <strong>По значению</strong>, если в КАССЕ для каждого товара указано его количество в формате "цена×количество" (например, "139.00x2").
                                    <br>- Используйте режим <strong>По упоминания</strong>, если в КАССЕ каждый экземпляр товара указан отдельной записью с количеством 1, а вам нужно подсчитать общее количество одинаковых товаров.
                                    <br>При переключении режима система автоматически выполнит повторный анализ данных.</p>
                                </div>
                            </div>

                            <div class="faq-item">
                                <div class="faq-question">
                                    <i class="fas fa-question-circle"></i>
                                    <span>Что означает кнопка "Без марки"?</span>
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                                <div class="faq-answer">
                                    <p>Кнопка "Без марки" позволяет скрыть или показать товары без маркировки в списке ошибок. Это помогает сосредоточиться на маркированных товарах, которые требуют вашего внимания. При нажатии кнопка меняет текст на "Показать марки" и подсвечивается зелёным цветом, показывая, что фильтр активен.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="guide-footer">
                <button class="btn primary-btn" id="closeGuide">
                    <i class="fas fa-check"></i> Понятно
                </button>
                <button class="btn secondary-btn" id="showNextTimeGuide">
                    <i class="fas fa-eye-slash"></i> Больше не показывать
                </button>
            </div>
        </div>
    </div>

    <!-- Добавляем скрипт для взаимодействия с Electron API -->
    <script>
        // Модифицируем функцию выбора файлов, если приложение запущено в Electron
        if (window.isElectron) {
            console.log("Приложение запущено в Electron");
            
            // Загружаем XLSX для Electron
            window.addEventListener('DOMContentLoaded', () => {
                try {
                    // Проверяем, был ли XLSX уже загружен в preload.js
                    if (typeof window.XLSX === 'undefined') {
                        console.log("XLSX не загружен в preload, пробуем загрузить вручную");
                        // В Electron используем require для загрузки XLSX
                        window.XLSX = require('./libs/xlsx.full.min.js');
                    }
                    
                    // Проверяем, что XLSX успешно загружен
                    if (typeof window.XLSX === 'undefined' || 
                        typeof window.XLSX.read !== 'function') {
                        throw new Error("XLSX не загружен корректно или метод read недоступен");
                    }
                    
                    console.log("XLSX загружен в Electron:", !!window.XLSX);
                } catch (e) {
                    console.error("Ошибка при загрузке XLSX в Electron:", e);
                    alert("Ошибка при загрузке библиотеки XLSX: " + e.message);
                }
                
                // Изменяем версию в настройках
                const versionElement = document.getElementById('versionNumber');
                if (versionElement) {
                    versionElement.textContent = "Версия: 1.0.0 (Desktop)";
                }
            });
        }
    </script>
    <script src="script.js"></script>
</body>
</html> 